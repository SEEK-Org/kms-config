'use strict';const aws=require('aws-sdk');module.exports=a=>new Promise((b,c)=>{a||c(new TypeError('Expected raw config object'));let d=JSON.parse(JSON.stringify(a));const e=new aws.KMS,f=[];Object.keys(d.kms||{}).forEach(g=>{f.push(new Promise((h,i)=>{e.decrypt({CiphertextBlob:new Buffer(d.kms[g],'base64')},(j,k)=>{j?i(j.stack):(d.kms[g]=k.Plaintext.toString('utf8'),h())})}))}),Promise.all(f).then(()=>{b(d)}).catch(g=>{c(g)})});
